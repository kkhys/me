@layer reset, tokens, base, layout, components, utilities;

@import "kiso.css" layer(reset);
@import "./uchu.css" layer(tokens);
@import "./prose.css" layer(components);

/* ===== Design Tokens ===== */

@layer tokens {
  :root {
    color-scheme: light dark;

    --radius: 0.625rem;
    --radius-md: calc(var(--radius) - 2px);

    --font-mono: ui-monospace, monospace;

    --c-bg: light-dark(var(--uchu-yang), var(--uchu-yin));
    --c-text: light-dark(var(--uchu-yin), var(--uchu-gray-1));
    --c-sub: light-dark(var(--uchu-yin-6), var(--uchu-yin-4));

    --c-primary: light-dark(var(--uchu-yin-9), var(--uchu-gray-2));
    --c-primary-text: light-dark(var(--uchu-yang), var(--uchu-yin-9));

    --c-surface: light-dark(var(--uchu-gray-1), var(--uchu-yin-9));
    --c-surface-text: light-dark(var(--uchu-yin-9), var(--uchu-yang));

    --c-border: light-dark(
      var(--uchu-gray-2),
      oklch(var(--uchu-yang-raw) / 10%)
    );
    --c-ring: light-dark(var(--uchu-yin-4), var(--uchu-yin-6));

    --c-link: light-dark(var(--uchu-blue-5), var(--uchu-blue-3));
    --c-link-visited: light-dark(var(--uchu-purple-5), var(--uchu-purple-3));

    --c-strong: light-dark(var(--uchu-yellow-1), var(--uchu-orange-9));
    --c-hr: light-dark(var(--uchu-gray-1), var(--uchu-yin-9));

    --c-code-bg: light-dark(
      oklch(var(--uchu-gray-3-raw) / 0.2),
      oklch(var(--uchu-gray-2-raw) / 0.05)
    );
    --c-code-text: light-dark(var(--uchu-yin-8), var(--uchu-gray-3));
    --c-code-border: light-dark(
      oklch(var(--uchu-gray-9-raw) / 0.2),
      oklch(var(--uchu-yin-4-raw) / 0.3)
    );

    --c-codeblock-bg: light-dark(var(--uchu-yang), var(--uchu-yin));
    --c-codeblock-header-bg: light-dark(var(--uchu-yang), var(--uchu-yin-9));
    --c-codeblock-header-text: light-dark(
      var(--uchu-yin-6),
      var(--uchu-gray-3)
    );
    --c-codeblock-border: light-dark(
      oklch(var(--uchu-gray-3-raw) / 0.3),
      oklch(var(--uchu-yang-raw) / 0.1)
    );
    --c-codeblock-gutter: light-dark(var(--uchu-gray-6), var(--uchu-gray-9));

    --fs-2xs: 0.65rem;
    --fs-xs: 0.75rem;
    --fs-sm: 0.875rem;
    --fs-lg: 1.25rem;

    --fw-normal: 400;
    --fw-medium: 500;
    --fw-semibold: 600;

    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  }
}

/* ===== Base Styles ===== */

@layer base {
  * {
    border-color: var(--c-border);
    outline-color: oklch(from var(--c-ring) l c h / 50%);
  }

  html {
    font-family: system-ui, sans-serif;
    scrollbar-gutter: stable both-edges;
    scrollbar-color: light-dark(var(--uchu-gray-3), var(--uchu-yin-8))
      transparent;
    scrollbar-width: thin;
    background-color: var(--c-bg);
    color: var(--c-text);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1 {
    margin-block: 0;
    font-size: inherit;
  }

  hr {
    margin: 0;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-feature-settings: "palt";
    text-wrap: balance;
  }

  .budoux {
    word-break: keep-all;
    overflow-wrap: anywhere;
  }

  .palt {
    font-feature-settings: "palt";
  }

  ::selection {
    box-shadow: none;
    background-color: light-dark(var(--uchu-yellow-2), var(--uchu-yellow-9));
    color: var(--c-text);
  }

  li {
    margin-block: 0.5rem;
    padding-inline-start: 0.625rem;
  }

  [data-footnotes] {
    &::before {
      content: "";
      display: block;
      height: 1px;
      width: 100%;
      background-color: var(--c-hr);
    }

    & > ol {
      margin-top: 1.5rem;

      & > li {
        scroll-margin-top: 3rem;
      }
    }
  }

  [data-footnote-ref] {
    margin-left: 0.125rem;
    scroll-margin-top: 3rem;
    font-family: var(--font-mono);
  }

  [data-footnote-backref] {
    font-size: var(--fs-lg);
    font-family: var(--font-mono);
    line-height: 0;
    margin-left: 0.25rem;
  }

  .expressive-code {
    & pre {
      max-height: 650px !important;
    }

    & .copy button {
      border-radius: var(--radius-md) !important;

      &::after {
        mask-size: 0.8rem;
        margin: 0.6rem !important;
      }
    }
  }
}

/* ===== Common Layout Patterns ===== */

@layer layout {
  .back-link-wrapper {
    margin-bottom: 1rem;

    @media (width >= 1280px) {
      position: fixed;
      top: 0;
      transform: translateY(170px) translateX(-260px);
    }
  }

  .back-link {
    display: inline-flex;
    gap: 0.25rem;
    align-items: center;
    color: var(--c-sub);
    font-size: var(--fs-xs);
    font-feature-settings: "palt";
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }
  }

  .back-icon {
    width: 0.875rem;
    height: 0.875rem;
  }

  .page-title {
    font-weight: var(--fw-medium);
  }
}

/* ===== Button Components ===== */

@layer components {
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    white-space: nowrap;
    border-radius: var(--radius-md);
    font-size: var(--fs-sm);
    line-height: 1.25rem;
    font-weight: var(--fw-medium);
    transition:
      opacity 0.2s,
      background-color 0.2s,
      color 0.2s,
      box-shadow 0.2s,
      transform 0.15s ease;
    outline: none;
    flex-shrink: 0;
    height: 2.25rem;
    padding: 0.5rem 1rem;
    background-color: var(--c-primary);
    color: var(--c-primary-text);
    box-shadow: var(--shadow-sm);

    &:hover {
      opacity: 0.9;
    }

    &:active:not(:disabled) {
      transform: scale(0.95);
    }

    &:disabled {
      pointer-events: none;
      opacity: 0.5;
    }

    &:focus-visible {
      border-color: var(--c-ring);
      box-shadow: 0 0 0 3px oklch(from var(--c-ring) l c h / 50%);
    }

    & svg {
      pointer-events: none;
      flex-shrink: 0;

      &:not([class*="size-"]) {
        width: 1rem;
        height: 1rem;
      }
    }
  }

  .btn--outline {
    border: 1px solid var(--c-border);
    background-color: var(--c-bg);
    color: inherit;
    box-shadow: var(--shadow-sm);

    &:hover {
      background-color: var(--c-surface);
      color: var(--c-surface-text);
      opacity: 1;
    }
  }

  .btn--ghost {
    background-color: transparent;
    color: inherit;
    box-shadow: none;

    &:hover {
      background-color: var(--c-surface);
      color: var(--c-surface-text);
      opacity: 1;
    }
  }

  .btn--size-icon {
    width: 2.25rem;
    height: 2.25rem;
    padding: 0;
  }
}

/* ===== Play Button (shared by video-block and tweet-block) ===== */

@layer components {
  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgb(0 0 0 / 0.3);
    cursor: pointer;
    padding: 1rem;
    z-index: 10;
    transition:
      background-color 0.3s,
      transform 0.3s;
    border-radius: 9999px;
    border: 1px solid var(--c-border);
    opacity: 1;

    &:hover {
      background-color: rgb(0 0 0 / 0.4);
    }

    &:active {
      transform: translate(-50%, -50%) scale(0.95);
    }

    & svg {
      width: 2rem;
      height: 2rem;
      fill: white;
    }
  }
}

/* ===== Utility Classes ===== */

@layer utilities {
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
  }
}
