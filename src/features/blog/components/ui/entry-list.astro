---
import type { CollectionEntry } from "astro:content";
import type { HTMLAttributes } from "astro/types";
import Budoux from "#/components/budoux.astro";
import EmojiEyeCatch from "#/components/ui/emoji-eye-catch.astro";
import { convertDateToString } from "#/lib/date";

interface Props extends HTMLAttributes<"div"> {
  blogEntries: CollectionEntry<"blog">[];
  showDate?: boolean;
}

const {
  blogEntries,
  class: className,
  showDate = false,
  ...rest
} = Astro.props;
---

{
  blogEntries.length ? (
  <div class:list={["entry-list", className]} {...rest}>
    {blogEntries.map(({ id, data: { title, emoji, status, publishedAt }}) => {
      const publishedAtString = convertDateToString(publishedAt);
      return (
          <a href={`/blog/posts/${id}`} class="entry-item">
            <div class="entry-left">
              <EmojiEyeCatch emoji={emoji} size="sm" class="entry-emoji" />
              <Budoux>
                <p class="palt">{title}</p>
              </Budoux>
            </div>
            {showDate && (
                <time
                    class="entry-date palt"
                    datetime={publishedAt.toISOString()}
                >
                  {publishedAtString}
                </time>
            )}
            {status === "draft" && (
                <span class="entry-draft" />
            )}
          </a>
      )
    })}
  </div>
  ) : (
  <div class={className} {...rest}>
    <p>ブログ記事がありません。</p>
  </div>
  )
}

<style>
  .entry-list {
    border-top: 1px solid var(--c-border);
  }

  .entry-list > :global(* + *) {
    border-top: 1px solid var(--c-border);
  }

  .entry-item {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem 0.5rem;
    transition: background-color 0.2s;
    text-decoration: none;
    color: inherit;
  }

  .entry-item:hover {
    background-color: oklch(from var(--c-surface) l c h / 50%);
  }

  .entry-left {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .entry-emoji {
    flex-shrink: 0;
  }

  .entry-date {
    flex-shrink: 0;
    font-size: var(--fs-sm);
    font-variant-numeric: tabular-nums;
    color: var(--c-sub);
  }

  .entry-draft {
    position: absolute;
    right: 0;
    top: 0;
    height: 0.25rem;
    width: 0.5rem;
    background-color: oklch(from var(--uchu-red-4) l c h / 80%);
  }
</style>
