---
import type { HTMLAttributes } from "astro/types";
import Budoux from "#/components/budoux.astro";
import MoveUpRightIcon from "#/components/icons/move-up-right.svg";
import EmojiEyeCatch from "#/components/ui/emoji-eye-catch.astro";
import SiteIcon from "#/features/blog/components/ui/site-icon.astro";
import type { ListEntry } from "#/features/blog/utils/entry";
import { convertDateToString } from "#/utils/date";

interface Props extends HTMLAttributes<"div"> {
  entries: ListEntry[];
  showDate?: boolean;
}

const { entries, class: className, showDate = false, ...rest } = Astro.props;
---

{
  entries.length ? (
  <div class:list={["entry-list", className]} {...rest}>
    {entries.map((entry) => {
      const publishedAtString = convertDateToString(entry.publishedAt);

      if (entry.type === "external") {
        return (
          <a
            href={entry.url}
            class="entry-item"
            target="_blank"
            rel="noreferrer"
            data-astro-prefetch="false"
          >
            <div class="entry-left">
              <SiteIcon siteName={entry.siteName} />
              <Budoux>
                <p class="palt">
                  {entry.title}
                  <MoveUpRightIcon class="entry-external-icon" />
                </p>
              </Budoux>
            </div>
            {showDate && (
              <time
                class="entry-date palt"
                datetime={entry.publishedAt.toISOString()}
              >
                {publishedAtString}
              </time>
            )}
          </a>
        );
      }

      return (
        <a href={`/blog/posts/${entry.id}`} class="entry-item">
          <div class="entry-left">
            <EmojiEyeCatch emoji={entry.emoji} size="sm" class="entry-emoji" />
            <Budoux>
              <p class="palt">{entry.title}</p>
            </Budoux>
          </div>
          {showDate && (
            <time
              class="entry-date palt"
              datetime={entry.publishedAt.toISOString()}
            >
              {publishedAtString}
            </time>
          )}
          {entry.status === "draft" && (
            <span class="entry-draft" />
          )}
        </a>
      );
    })}
  </div>
  ) : (
  <div class={className} {...rest}>
    <p>ブログ記事がありません。</p>
  </div>
  )
}

<style>
  .entry-list {
    border-top: 1px solid var(--c-border);
  }

  .entry-list > :global(* + *) {
    border-top: 1px solid var(--c-border);
  }

  .entry-item {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem 0.5rem;
    font-size: var(--fs-sm);
    transition: background-color 0.2s;
    text-decoration: none;
    color: var(--c-prose-text);
  }

  .entry-item:hover {
    background-color: oklch(from var(--c-surface) l c h / 50%);
  }

  .entry-left {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .entry-date {
    flex-shrink: 0;
    font-size: var(--fs-sm);
    font-variant-numeric: tabular-nums;
    color: var(--c-sub);
  }

  .entry-draft {
    position: absolute;
    right: 0;
    top: 0;
    height: 0.25rem;
    width: 0.5rem;
    background-color: oklch(from var(--uchu-red-4) l c h / 80%);
  }

  .entry-external-icon {
    display: inline;
    width: 0.875rem;
    height: 0.875rem;
    margin-left: 0.25rem;
    vertical-align: -0.1em;
    color: var(--c-sub);
  }
</style>
