---
title: Mermaid ã‚’æ³³ãŒã›ã‚‹
emoji: ğŸ§œâ€â™€ï¸
category: Tech
tags: [Mermaid, React]
status: published
publishedAt: 2024-02-03
updatedAt: 2024-03-14
---

æ–‡å­—ã ã‘ã§è¦‹ã‚‹ã¨é›£ã—ãã†ãªã“ã¨ã§ã‚‚ã€å›³ã«èµ·ã“ã—ã¦ã¿ã‚‹ã“ã¨ã§æ§‹é€ ã‚’å˜ç´”åŒ–ã§ãã‚‹ã“ã¨ã¯å¤šã€…ã‚ã‚‹ã€‚
ãã®ãŸã‚ã€é ­ã§è€ƒãˆã‚‹ã ã‘ã§ã¯ãªãã€æ€è€ƒã‚’è¦–è¦šåŒ–ã™ã‚‹ç™–ã‚’ã¤ã‘ãŸã„ã€‚

ãã‚“ãªã¨ãã«æœ‰åŠ¹ãªãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ [Mermaid](https://mermaid.js.org) ãŒã‚ã‚‹ã€‚
ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ãªã©æ§˜ã€…ãªãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã®ç”Ÿæˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã€‚

[draw.io](https://www.drawio.com) ã®ã‚ˆã†ãªä½œå›³ãƒ„ãƒ¼ãƒ«ã¨ã¯é•ã„ã€Markdown ã¨åŒæ§˜ã«ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆã§ãã‚‹ã®ãŒç‰¹å¾´ã§ã‚ã‚‹ã€‚
ã‚‚ã¡ã‚ã‚“ã€GUI ã§ä½œå›³ã™ã‚‹ã®ã¨ã¯ç•°ãªã‚Šã€ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒªãƒƒãƒã•ã§ã¯åŠ£ã‚‹ãŒæŠ½è±¡çš„ã«è€ƒãˆã‚‹ã«ã¯ãã®ã»ã†ãŒã‚€ã—ã‚å¥½éƒ½åˆãªã“ã¨ã‚‚ã‚ã‚‹ã€‚

Mermaid ãŒä½•ã‚ˆã‚Šç´ æ™´ã‚‰ã—ã„ã®ã¯ã€å›³ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã« GUI ã‚’é–‹ã„ã¦ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã¨ã„ã£ãŸç…©ã‚ã—ã„ä½œæ¥­ã«æ™‚é–“ã‚’å–ã‚‰ã‚Œãªã„ç‚¹ã ã‚ã†ã€‚
ãƒ†ã‚­ã‚¹ãƒˆã‚’æ•°æ–‡å­—å¤‰ãˆã‚‹ã ã‘ã§æ¸ˆã‚€ã€‚
ã‚ã¨ã¯ã€ã¡ã‚‡ã£ã¨ç·šãŒãšã‚ŒãŸã‚Šã—ã¦ã‚¹ãƒˆãƒ¬ã‚¹ãŒæºœã¾ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚ãªã„ã€‚

ã•ã¦ã€ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ãƒ­ã‚¸ã‚«ãƒ«ãªéƒ¨åˆ†ã¯ã§ãã‚‹ã ã‘å›³ã‚„è¡¨ã«ã—ã¦ã‚ã‹ã‚Šã‚„ã™ãã—ãŸã„ã€‚
ãã“ã§ MDX ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ Mermaid è¨˜æ³•ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ãŸï¼ˆv1.4.10ï¼‰ã€‚

https://github.com/kkhys/me/issues/493

## å®Ÿè£…æ–¹æ³•

[rehype-mermaid](https://github.com/remcohaszing/rehype-mermaid) ã¨ã„ã†ãƒ‰ãƒ³ãƒ”ã‚·ãƒ£ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸã€‚

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è‰¯ã„ã¨ã“ã‚ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ SVG ã®ç”Ÿæˆã‚’ãƒ“ãƒ«ãƒ‰æ™‚ã«è¡Œã£ã¦ãã‚Œã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚
å†…éƒ¨çš„ã« [Playwright](https://playwright.dev) ã®ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã ã€‚

<Alert type='warning' description='CI ç’°å¢ƒã§ã¯ãƒ“ãƒ«ãƒ‰ãŒä¸å®‰å®šã«ãªã‚‹ç¾è±¡ãŒä½•åº¦ã‹è¦³æ¸¬ã•ã‚Œã¦ã„ã‚‹ã€‚ãƒ‡ãƒãƒƒã‚°ã«è‡ªä¿¡ãŒãªã‘ã‚Œã° rehype-mermaid ã®ä½¿ç”¨ã¯æ§ãˆãŸæ–¹ãŒè‰¯ã•ãã†ã€‚' />

Mermaid ã®æç”»ã¯é€šå¸¸ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰å´ã§è¡Œã‚ã‚Œã‚‹ãŒã€ãã®éš›ã«ãƒãƒ¼ãƒ‰ã®æ•°ãŒå¤šããªã‚Œã°ãªã‚‹ã»ã©è² è·ãŒé«˜ããªã£ã¦ã—ã¾ã†ã€‚
ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã®ã¨ãã‚‚ãã†ã ã£ãŸãŒã€å¯èƒ½ãªé™ã‚Š SSG ã§ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è‰¯ãã—ãŸã„ã€‚

ã¨ã‚Šã‚ãˆãšä½¿ã†ã ã‘ãªã‚‰ä»¥ä¸‹ã®ã‚ˆã†ã« `rehypePlugins` ã«è¿½åŠ ã™ã‚‹ã ã‘ã§è‰¯ã„ã€‚
ã“ã®éš›ã®æ³¨æ„ç‚¹ã¨ã—ã¦ã€[rehype-pretty-code](https://github.com/rehype-pretty/rehype-pretty-code) ãªã©ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆç³»ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãã‚Œã‚ˆã‚Šã‚‚å‰ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```ts title="contentlayer.config.ts" showLineNumbers {6}
import rehypeMermaid from 'rehype-mermaid';

export default makeSource({
  mdx: {
    rehypePlugins: [
      [rehypeMermaid]
    ],
  },
});
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ©Ÿèƒ½ã ã‘ã§ã‚‚ååˆ†ã ãŒã€ãƒ‡ã‚¶ã‚¤ãƒ³é¢ã§æ°—ã«å…¥ã‚‰ãªã„éƒ¨åˆ†ãŒã‚ã£ãŸã®ã§èª¿æ•´ã—ãŸã€‚

`rehype-mermaid` ã®è¨­å®šã¯å¤‰æ›´ã—ã¦ã„ãªã„ã€‚
å¤‰æ›´ã—ãŸã®ã¯ Mermaid å…¬å¼ã®è¨­å®šã®ã¿ã€‚

https://mermaid.js.org/config/schema-docs/config.html

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã‚‚ã„ã¾ã„ã¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸãŒã€å¹¸ã„ã«ã‚‚ TypeScript ã®å‹å®šç¾©ãŒã•ã‚Œã¦ã„ãŸã®ã§ãã‚Œã‚’å…ƒã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ã„ãŸã€‚

```ts title="src/lib/mdx/rehype-mermaid.ts" showLineNumbers
import type { RehypeMermaidOptions } from 'rehype-mermaid';

const mermaidConfig = {
  theme: 'base',
  fontFamily:
    'ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',
  fontSize: 13,
  themeVariables: {
    primaryColor: '#b0b0b0',
    secondaryColor: '#545480',
    primaryBorderColor: '#4c4c53',
    primaryTextColor: '#f4f4f5',
    secondaryTextColor: '#f4f4f5',
    lineColor: '#4c4c53',
    textColor: '#f4f4f5',
    ...
  },
} satisfies RehypeMermaidOptions['mermaidConfig'];

export const rehypeMermaidOptions = {
  mermaidConfig,
} satisfies RehypeMermaidOptions;
```

`fontFamily` ã«ã¯æœ¬å½“ã¯ Inter ã‚’ä½¿ã„ãŸã‹ã£ãŸãŒã€`next/font` ã‚’ä½¿ã£ã¦ã„ã‚‹éƒ½åˆä¸Šã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒã†ã¾ãã„ã‹ãªã‹ã£ãŸãŸã‚è«¦ã‚ãŸï¼ˆæ–‡å­—ãŒãšã‚Œã¦ã—ã¾ã†ï¼‰ã€‚

`themeVariables` ã¯å›³ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚
ç‹¬è‡ªã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ã™ã‚‹å ´åˆã¯ `theme` ã‚’ `base` ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

ãã‚Œãã‚Œã®è‰²ã‚’æŒ‡å®šã—ã¦ã„ãã®ã ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚ä¹—ã£ã¦ã„ãªã„ãŸã‚ [å®Ÿéš›ã®ãƒ†ãƒ¼ãƒ](https://github.com/mermaid-js/mermaid/blob/develop/packages/mermaid/src/themes/theme-dark.js) ã‚’å®šç¾©ã—ã¦ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚è€ƒã«ã—ã¦æ›¸ã„ãŸã€‚

åˆ†é‡ãŒå¤šã™ãã‚‹ã®ã¨ã€ãã‚Œãã‚Œã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã©ã®ãƒ‘ãƒ¼ãƒ„ã«ç´ã¥ã„ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚‰ãšã« 1 ã¤ãšã¤ç¢ºèªã—ãŸã®ã§éª¨ãŒæŠ˜ã‚Œã‚‹ä½œæ¥­ã§ã‚ã£ãŸã€‚

é€”æ–¹ã‚‚ãªã„ã®ã§ã²ã¨ã¾ãšã¯é »ç¹ã«ä½¿ã†ã§ã‚ã‚ã†ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã®ã¿è‰²å¡—ã‚Šã—ãŸã€‚

ã‚ã¨ã¯ã€ã“ã‚Œã¯ãƒã‚°ã ã¨æ€ã†ãŒã€ãã®ã¾ã¾ä½¿ã†ã¨æ–‡å­—ãŒãšã‚Œã¦æç”»ã•ã‚Œã¦ã—ã¾ã†ã®ã§å…¨ä½“ã« `line-height: 1.1rem` ã‚’æŒ‡å®šã—ã¦ã‚ã‚‹ã€‚

## Mermaid ã®ä¾‹

å‰è¿°ã—ãŸã¨ãŠã‚Šã€å…¨ã¦ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚’ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã™ã‚‹ã®ã¯æ™‚é–“çš„ã«ç„¡ç†ã ã£ãŸãŸã‚ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã—ãŸã‚‚ã®ã ã‘ä¾‹ç¤ºã™ã‚‹ã€‚
ä»Šå¾Œä½¿ã†æ©Ÿä¼šãŒã‚ã‚Œã°åˆ¥ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚‚è¿½è¨˜ã—ã¦ã„ãã€‚

### Flowchart

````md
```mermaid
flowchart TB
    c1 --> a2

    subgraph one
    a1 --> a2
    end

    subgraph two
    b1 --> b2
    end

    subgraph three
    c1 --> c2
    end

    one --> two
    three --> two
    two --> c2
```
````

<p className='text-center'>â†“</p>

```mermaid
flowchart TB
    c1 --> a2

    subgraph one
    a1 --> a2
    end

    subgraph two
    b1 --> b2
    end

    subgraph three
    c1 --> c2
    end

    one --> two
    three --> two
    two --> c2
```

### Sequence diagrams

````md
```mermaid
sequenceDiagram
    autonumber

    Alice ->> John: Hello John, how are you?

    loop Healthcheck
        John ->> John: Fight against hypochondria
    end

    Note right of John: Rational thoughts!

    John -->> Alice: Great!
    John ->> Bob: How about you?
    Bob -->> John: Jolly good!
```
````

<p className='text-center'>â†“</p>

```mermaid
sequenceDiagram
    autonumber

    Alice ->> John: Hello John, how are you?

    loop Healthcheck
        John ->> John: Fight against hypochondria
    end

    Note right of John: Rational thoughts!

    John -->> Alice: Great!
    John ->> Bob: How about you?
    Bob -->> John: Jolly good!
```

### State diagrams

````md
```mermaid
stateDiagram-v2
    state fork_state <<fork>>
        [*] --> fork_state
        fork_state --> State2
        fork_state --> State3

    state join_state <<join>>
        State2 --> join_state
        State3 --> join_state
        join_state --> State4
        State4 --> [*]
```
````

<p className='text-center'>â†“</p>

```mermaid
stateDiagram-v2
    state fork_state <<fork>>
        [*] --> fork_state
        fork_state --> State2
        fork_state --> State3

    state join_state <<join>>
        State2 --> join_state
        State3 --> join_state
        join_state --> State4
        State4 --> [*]
```

### Gitgraph Diagrams

````md
```mermaid
gitGraph
    commit id: "ZERO"
    branch develop
    branch release
    commit id: "A"
    checkout main
    commit id: "ONE"
    checkout develop
    commit id: "B"
    checkout main
    merge develop id: "MERGE"
    commit id: "TWO"
    checkout release
    cherry-pick id: "MERGE" parent:"B"
    commit id: "THREE"
    checkout develop
    commit id: "C"
```
````

<p className='text-center'>â†“</p>

```mermaid
gitGraph
    commit id: "ZERO"
    branch develop
    branch release
    commit id: "A"
    checkout main
    commit id: "ONE"
    checkout develop
    commit id: "B"
    checkout main
    merge develop id: "MERGE"
    commit id: "TWO"
    checkout release
    cherry-pick id: "MERGE" parent:"B"
    commit id: "THREE"
    checkout develop
    commit id: "C"
```

## ã‚„ã£ã¦ã¿ãŸã„ã“ã¨ãƒ¡ãƒ¢

- ã‚³ãƒ¼ãƒ‰ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
- æ‹¡å¤§ãƒ»ç¸®å°ã‚’ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
